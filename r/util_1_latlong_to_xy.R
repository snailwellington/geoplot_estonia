

# Function for single items ----------------------------------------------------------------

geo_lest <- function(lat, lon) {

  LAT = (lat*(pi/180))
  LON = (lon*(pi/180))
  a = 6378137.000000000000
  F_item = 298.257222100883
  RF = F_item
  F_item = (1/F_item)
  B0 = ((57.000000000000 + 31.000000000000 / 60.000000000000 + 3.194148000000 / 3600.000000000000)*(pi/180))
  L0 = ((24.000000000000)*(pi/180))
  FN = 6375000.000000000000
  FE = 500000.000000000000
  B1 = ((59.000000000000 + 20.000000000000 / 60.000000000000)*(pi/180))
  B2 = ((58.000000000000)*(pi/180))
  xx = (lat - FN)
  yy = (lon - FE)
  f1 = (1 / RF)
  er = ((2.000000000000 * f1) - (f1 * f1))
  e = sqrt(er)
  t1 = sqrt(((1.000000000000 - sin(B1)) / (1.000000000000 + sin(B1))) * ((((1.000000000000 + e * sin(B1)) / (1.000000000000 - e * sin(B1)))^e)))
  t2 = sqrt(((1.000000000000 - sin(B2)) / (1.000000000000 + sin(B2))) * ((((1.000000000000 + e * sin(B2)) / (1.000000000000 - e * sin(B2)))^e)))
  t0 = sqrt(((1.000000000000 - sin(B0)) / (1.000000000000 + sin(B0))) * ((((1.000000000000 + e * sin(B0)) / (1.000000000000 - e * sin(B0)))^e)))
  t = sqrt(((1.000000000000 - sin(LAT)) / (1.000000000000 + sin(LAT))) * ((((1.000000000000 + e * sin(LAT)) / (1.000000000000 - e * sin(LAT)))^e)))
  m1 = (cos(B1) / (((1.000000000000 - er * sin(B1) * sin(B1))^0.500000000000)))
  m2 = (cos(B2) / (((1.000000000000 - er * sin(B2) * sin(B2))^0.500000000000)))
  n = ((log(m1) - log(m2)) / (log(t1) - log(t2)))
  FF = (m1 / (n * t1^n))
  p0 = (a * FF * (t0^n))
  FII = (n * (LON - L0))
  p = (a * FF * t^n)
  n = (p0 - (p * cos(FII)) + FN)
  e = (p * sin(FII) + FE)
  
  tmp_coords <- c(n,e)
  return(tmp_coords)
}


# Function for single items ----------------------------------------------------------------



geo_lest_vec <- function(coords) {
  
  lat <- coords[1]
  lon <- coords[2]
  LAT = (lat*(pi/180))
  LON = (lon*(pi/180))
  a = 6378137.000000000000
  F_item = 298.257222100883
  RF = F_item
  F_item = (1/F_item)
  B0 = ((57.000000000000 + 31.000000000000 / 60.000000000000 + 3.194148000000 / 3600.000000000000)*(pi/180))
  L0 = ((24.000000000000)*(pi/180))
  FN = 6375000.000000000000
  FE = 500000.000000000000
  B1 = ((59.000000000000 + 20.000000000000 / 60.000000000000)*(pi/180))
  B2 = ((58.000000000000)*(pi/180))
  xx = (lat - FN)
  yy = (lon - FE)
  f1 = (1 / RF)
  er = ((2.000000000000 * f1) - (f1 * f1))
  e = sqrt(er)
  t1 = sqrt(((1.000000000000 - sin(B1)) / (1.000000000000 + sin(B1))) * ((((1.000000000000 + e * sin(B1)) / (1.000000000000 - e * sin(B1)))^e)))
  t2 = sqrt(((1.000000000000 - sin(B2)) / (1.000000000000 + sin(B2))) * ((((1.000000000000 + e * sin(B2)) / (1.000000000000 - e * sin(B2)))^e)))
  t0 = sqrt(((1.000000000000 - sin(B0)) / (1.000000000000 + sin(B0))) * ((((1.000000000000 + e * sin(B0)) / (1.000000000000 - e * sin(B0)))^e)))
  t = sqrt(((1.000000000000 - sin(LAT)) / (1.000000000000 + sin(LAT))) * ((((1.000000000000 + e * sin(LAT)) / (1.000000000000 - e * sin(LAT)))^e)))
  m1 = (cos(B1) / (((1.000000000000 - er * sin(B1) * sin(B1))^0.500000000000)))
  m2 = (cos(B2) / (((1.000000000000 - er * sin(B2) * sin(B2))^0.500000000000)))
  n = ((log(m1) - log(m2)) / (log(t1) - log(t2)))
  FF = (m1 / (n * t1^n))
  p0 = (a * FF * (t0^n))
  FII = (n * (LON - L0))
  p = (a * FF * t^n)
  n = (p0 - (p * cos(FII)) + FN)
  e = (p * sin(FII) + FE)
  
  
  tmp_coords <- c(n,e)
  return(tmp_coords)
}




options(digits = 20)

### paranda power funktsioonid Ã¤ra


# Test --------------------------------------------------------------------


x <- 6463667.53515625
y <- 682539.61328125
AJ <- "Esimene"
coords <- lest_geo(1,x,y, AJ)


geo_lest(lat = 58.27562, lon = 27.11213)


coords <- c(58.27562,27.11213)


geo_lest_vec(coords = coords)
